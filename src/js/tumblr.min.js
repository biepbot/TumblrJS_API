function _t(e){if(!(this instanceof _t))return new _t(e);this.load=function e(t){if(v()){if(!Y&&(Y=!0)){if(P(),x("preventload"))return;I("preventload",!0),"number"==typeof t?S(t):"string"==typeof t&&console.error("Can only load integer amounts. For getting single posts, set the postID in settings")}}else E(v,function(){e(t)},200)};var t=0;function n(e,t){for(var n=0;n<r.length;n++){var o=r[n];o.event!==e&&"on"+o.event!==e||o.function(t)}}this.loadNewPosts=function(){var e=x("index");I("index",t),t=e;var n=x("stop");M(),I("stop",!1),s=1,A(function(){R(!0),x().index+=t,t=0,M(),I("stop",n)})},this.setBlog=function(e){u=e},this.settings={},this.getCache=x,this.filter=function(e){if(M(),!e.length){var t=[];t.push.v,e=t}d=e,P(),S(5)},this.addEventListener=function(e,t){var n={};n.event=e,n.function=t,r.push(n)},this.removeEventListener=function(e,t){var n={};n.event=e,n.function=t,function(e){var t,n,r=arguments,o=r.length;for(;o>1&&e.length;)for(t=r[--o];-1!==(n=e.indexOf(t));)e.splice(n,1)}(r,n)};var r=[],o=e.template||0;if(o)if(o instanceof HTMLElement)o=function(e,t){if(!e||!e.tagName)return"";var n,r,o=document.createElement("div");o.appendChild(e.cloneNode(!1)),n=o.innerHTML,t&&(r=n.indexOf(">")+1,n=n.substring(0,r)+e.innerHTML+n.substring(r));return o=null,n}(e.template,!0),e.template.parentNode.removeChild(e.template);else if(-1!==o.indexOf("<"));else{var i=new XMLHttpRequest;i.open("GET",o,!0),i.onreadystatechange=function(){4===i.readyState&&200===i.status?o=this.responseText:200!==i.status&&console.error(i.status+' ERROR during loading "'+i.responseURL+'": \r\n'+i.responseText)},i.send()}else console.error("No template was given");var a=this,u=e.blog||"biepbot",s=0,l=[],d=[];function f(){return a.settings.postID||-1}var c=e.template||5e3,p=e.type,v=function(){return-1!==o.indexOf("<")},g=function(){return a.settings.thumbsize||400};function m(){return-1!==f()}function h(e){if(!e)return"unknown";var t,n,r,o,i,a,u,s,l,d,f,c,p,v,g,m,h,y=(t="yyyy-mm-dd hh:ii:ss GMT",n=e.replace(/[^a-zA-Z0-9]/g,"-"),r=t.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").split("-"),o=n.split("-"),i=r.indexOf("mm"),a=r.indexOf("dd"),u=r.indexOf("yyyy"),s=r.indexOf("hh"),l=r.indexOf("ii"),d=r.indexOf("ss"),f=new Date,c=u>-1?o[u]:f.getFullYear(),p=i>-1?o[i]-1:f.getMonth()-1,v=a>-1?o[a]:f.getDate(),g=s>-1?o[s]:f.getHours(),m=l>-1?o[l]:f.getMinutes(),h=d>-1?o[d]:f.getSeconds(),new Date(c,p,v,g,m,h)),b=((new Date).getTime()-y.getTime())/1e3,O=Math.floor(b/86400);return isNaN(O)||O<0||O>=31?function(e){var t=e.getMinutes();t<10&&(t="0"+t);return e.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getFullYear()+" "+e.getHours()+":"+t}(y):0==O&&((b<60?"just now":b<120&&"1 minute ago")||b<3600&&Math.floor(b/60)+" minutes ago"||b<7200&&"1 hour ago"||b<86400&&Math.floor(b/3600)+" hours ago")||1==O&&"Yesterday"||O<7&&O+" days ago"||O<31&&Math.ceil(O/7)+" weeks ago"}function y(e){for(var t=(e+="").split("."),n=t[0],r=t.length>1?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1,$2");return n+r}function b(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}function O(e,t){if(!b(e,t)){var n=" ";return r=e.className,o=n,-1!==r.indexOf(o,r.length-o.length)&&(n=""),e.className+=n+t,!0}var r,o;return!1}function T(e,t){var n=""===window.location.hostname?"":"/";t&&(n="");var r=document.createElement("script");r.async="true",r.src=n+e;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(r,o)}function N(e,t){return e/t>1.25||t/e>1.25}function E(e,t,n,r,o){null==n&&(n=100);var i=+new Date;null==r&&(r=Number.POSITIVE_INFINITY);var a=function(){+new Date-i>r?o&&o():e()?t():setTimeout(a,n)};a()}function L(e){var t=x();for(var n in e)t.posts.push(e[n])}function x(e){return e?C()[e]:C()}function I(e,t){x()[e]=t}function M(){G(),I("index",0),t=0,lastReturn=0,I("stop",!1),I("preventload",!1),I("posts",[]),I("loaded-images",[])}function C(){return qobj=function(e,t,n){var r;for(var o in e){var i=e[o];if(i.id===t){r=i;break}}return n&&(r=n(r)),r}(l,u,w)}function w(e){return e||((e={}).id=u,e.posts=[],e["loaded-images"]=[],e.stop=!1,e.preventload=!1,e.index=0,l.push(e)),e}function S(e,t){s=e,G(),n("beforeload"),k(t)}function _(){return null!=tumblr_api_read}function D(e){e?I("stop",!0):n("onerror")}function k(e){for(;s>0;){var t=x("posts").shift();if(null==t)return x("stop")?void n("onstop"):void A(R);var r=t["reblog-key"]+t.id;null==document.getElementById(r)?n(e?"doubleload":"afterload",V(t)):(n("ondouble"),s++),s--,x().index+=1}0==x("posts").length?n("onstop"):I("preventload",!1)}function A(e){(function(){var e=d[0]||!1;if(s>x("posts").length){tumblr_api_read=null;var t="http://"+u+".tumblr.com/api/read/json?";if(m())T(t+"id="+f(),!0);else{var n=e?"&tagged="+htmlEncode(e):"",r=0!=p?"&type="+p:"",o=t+"num=50&start="+x("index")+r+n;T(o,!0)}return!0}return!1})()&&E(_,e,100,c,D)}var Y=!1;function P(){Y=!1}function R(e){if(_()&&!(s>50)){var t=d.length>0?48:50;L(tumblr_api_read.posts),tumblr_api_read.posts.length<t&&D(!0),tumblr_api_read.posts.length=0;var n;if(!a.settings.reblogs)n=(n=x("posts")).filter(function(e,t,n){return null==n[t]["reblogged-from-name"]}),I("posts",[]),L(n);if(!a.settings.submissions)n=(n=x("posts")).filter(function(e,t,n){return 0==n[t]["is-submission"]}),I("posts",[]),L(n);if(d.length<=1)k(e);else n=(n=x("posts")).filter(function(e,t,n){var r=!1,o=n[t].tags;for(var i in d){var a=!1;for(var u in o)if(a=o[u].toLowerCase()===d[i].toLowerCase())break;if(r=!a)break}return n.lastIndexOf(e)===t&&!r}),I("posts",[]),L(n),k(e);P(),tumblr_api_read=null}}function G(){var e=document.getElementsByTagName("script");for(var t in e){var n=e[t];null!=n&&null!=n.src&&-1!==n.src.indexOf("tumblr")&&(n.parentNode.removeChild(n),t--)}tumblr_api_read=null}function H(e){var t={};t.id=e.id,t["reblog-key"]=e["reblog-key"],t["note-count"]=e["note-count"],t.type=e.type;var n=e["reblogged-from-name"];return null==n&&(n=e),t.origin=n,t.source=e.url,t["date-NL"]=e.date,t["date-GMT"]=e["date-gmt"],t.tags=e.tags,t.description=e["photo-caption"],t["like-button"]=e["like-button"],t["reblog-button"]=e["reblog-button"],t["is-submission"]=e["is-submission"],t}var B=[];function U(e,t,n){B.push({name:e,type:t,content:n})}function q(e,t,n){return r=e,o="_T("+t.name+")",i=function(){return t.content(n)},r.replace(new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),i);var r,o,i}function F(e){return e["date-GMT"]}function V(e){var t,n,r,i,a,u,s,l,d,f,c,p;"regular"===e.type?((p=H(c=e)).title=c["regular-title"],p.body=c["regular-body"],e=p):"photo"===e.type?e=function(e){var t=H(e);t["image-alt"]=e.slug;var n=[];for(var r in e)if(e.hasOwnProperty(r)&&-1!==r.indexOf("photo-url-")){var o={};o.source=e[r],n.push(o)}return t.images=n,t["extra-images"]=e.photos,t}(e):"link"===e.type?((f=H(d=e)).title=d["link-text"],f.body=d["link-description"],f.url=d["link-url"],e=f):"quote"===e.type?((l=H(s=e)).title=s["quote-source"],l.body=s["quote-text"],e=l):"conversation"===e.type?((u=H(a=e)).conversation=a.conversation,e=u):"audio"===e.type?((i=H(r=e)).audio={},i.audio.caption=r["audio-caption"],i.audio.embed=r["audio-embed"],i.audio.player=r["audio-player"],i.audio.plays=r["audio-plays"],i.id3={},i.id3.album=r["id3-album"],i.id3.artist=r["id3-artist"],i.id3.title=r["id3-title"],i.title=i.id3.title,i.id3.track=r["id3-track"],i.id3.year=r["id3-year"],e=i):"video"===e.type?((n=H(t=e)).body=t["video-caption"],n.video={},n.video.embed=t["video-player"],e=n):console.warn("Unsupported tumblr type:"+e.type);var v,g,m=o;return m=function(e,t){for(var n=0;n<B.length;n++){var r=B[n];"v"===r.type&&(e=q(e,r,t))}return e}(m,e),v=m,(g=document.createElement("div")).innerHTML=v.trim(),function(e,t){for(var n=0;n<B.length;n++){var r=B[n];if("e"===r.type){var o=e.querySelector('[id*="_T('+r.name+')"]');o&&(o.id="",i=o,a=t,r.content(i,a))}}var i,a}(m=g.firstChild,e),m}U("ID","v",function(e){return e.id}),U("REBLOG","v",function(e){return"https://www.tumblr.com/reblog/"+e.id+"."+e["reblog-key"]}),U("BLOG","v",function(e){return u}),U("NOTES","v",function(e){var t=e["note-count"];return 1==t?t+" note":t+" notes"}),U("NICENOTES","v",function(e){var t=e["note-count"];return 1==(t=y(t))?t+" note":t+" notes"}),U("DESCRIPTION","v",function(e){return e.description||""}),U("TYPE","v",function(e){return e.type}),U("TITLE","v",function(e){return e.title||""}),U("BODY","v",function(e){return e.body||""}),U("ARTIST","v",function(e){if(e.id3)return e.id3.artist;return""}),U("PLAYS","v",function(e){if(e.audio){var t=e.audio.plays;return 1==t?t+" time":t+" times"}return""}),U("NICEPLAYS","v",function(e){if(e.audio){var t=e.audio.plays;return 1==(t=y(t))?t+" time":t+" times"}return""}),U("YEAR","v",function(e){if(e.id3)return e.id3.year;return""}),U("URL","v",function(e){return e.url||""}),U("DATE","v",F),U("NICEDATE","v",function(e){return h(e["date-GMT"])||F(e)}),U("IMAGE","e",function(e,t){var n=t.images;if(n&&n.length){var r=n[1].source;if("IMG"===e.tagName)e.src=r;else{var o=document.createElement("img");o.src=r,e.appendChild(o)}}}),U("REBLOG_BUTTON","e",function(e,t){e.innerHTML=t["reblog-button"]}),U("IMAGES","e",function(e,t){var n=0,r=t["extra-images"];if(!r)return;for(var o=1;o<r.length;o++){n++;var i=r[o]["photo-url-250"],a=r[o].width,u=r[o].height;image=document.createElement("img");var s=N(a,u),l=r.length-1==o;if(s)n=0,O(image,"broad"),i=r[o]["photo-url-"+g()];else{var d=n%2==1;if(d&&!l){var f=r[o+1].width,c=r[o+1].height;(s=N(f,c))&&(n=0,O(image,"broad"),i=r[o]["photo-url-"+g()])}else l&&(d?(n=0,O(image,"broad"),i=r[o]["photo-url-"+g()]):n=0)}image.src=i,p=image,x()["loaded-images"].push(p),image.alt="extra-image",e.appendChild(image)}var p}),U("TAGS","e",function(e,t){for(var n="",r=t.tags||[],o=0;o<r.length;o++){var i=r[o];n+="<li>"+i+"</li>"}e.innerHTML=n}),U("CONVERSATION","e",function(e,t){for(var n="",r=t.conversation||[],o=0;o<r.length;o++){var i=r[o];n+='<li class="conversation"><span class="name">'+i.name+"</span>",n+='<span class="phrase">'+i.phrase+"</span></li>"}e.innerHTML=n}),U("AUDIO","e",function(e,t){if(!t.audio)return;e.innerHTML=t.audio.embed}),U("VIDEO","e",function(e,t){if(!t.video)return;e.innerHTML=t.video.embed}),U("SINGLE-POST-ONLY","e",function(e,t){m()||e.parentNode.removeChild(e)}),U("MULTI-POST-ONLY","e",function(e,t){m()&&e.parentNode.removeChild(e)}),U("REGULAR-POST-ONLY","e",function(e,t){"regular"!==t.type&&e.parentNode.removeChild(e)}),U("LINK-POST-ONLY","e",function(e,t){"link"!==t.type&&e.parentNode.removeChild(e)}),U("PHOTO-POST-ONLY","e",function(e,t){"photo"!==t.type&&e.parentNode.removeChild(e)}),U("QUOTE-POST-ONLY","e",function(e,t){"quote"!==t.type&&e.parentNode.removeChild(e)}),U("CONVERSATION-POST-ONLY","e",function(e,t){"conversation"!==t.type&&e.parentNode.removeChild(e)}),U("AUDIO-POST-ONLY","e",function(e,t){"audio"!==t.type&&e.parentNode.removeChild(e)}),U("VIDEO-POST-ONLY","e",function(e,t){"video"!==t.type&&e.parentNode.removeChild(e)})}